<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Quản lý tài khoản</title>
    <style>
        body {background: linear-gradient(135deg, #0d0d0d, #1a1a1a);color: #f5f5f5;font-family: 'Orbitron', sans-serif;padding: 20px;}
        h1, h2 {color: #ff073a;text-shadow: 0 0 10px #ff073a, 0 0 20px #ff073a;}
        a {color: #ff073a;text-decoration: none;margin-right: 15px;font-weight: bold;text-shadow: 0 0 5px #ff073a;}
        a:hover {color: #fff;text-shadow: 0 0 10px #ff073a, 0 0 20px #ff073a;}
        table {width: 100%;border-collapse: collapse;background: rgba(20,20,20,0.9);box-shadow: 0 0 15px #ff073a;margin: 20px 0;}
        th, td {border: 1px solid #ff073a;padding: 10px;text-align: center;}
        th {background: #ff073a;color: #fff;text-shadow: 0 0 5px #000;}
        tr:nth-child(even) {background: #1e1e1e;}
        tr:hover {background: #2a2a2a;box-shadow: inset 0 0 10px #ff073a;}
        .nav-links {margin-bottom: 20px;padding: 15px;background: rgba(30,30,30,0.85);border-radius: 8px;border: 1px solid #ff073a;}
        .status-active {color: #00ff00;font-weight: bold;text-shadow: 0 0 5px #00ff00;}
        .status-inactive {color: #ff073a;font-weight: bold;text-shadow: 0 0 5px #ff073a;}
        .action-buttons {display: flex;gap: 5px;justify-content: center;}
        .btn {padding: 5px 10px;border: none;border-radius: 3px;cursor: pointer;font-size: 12px;text-decoration: none;}
        .btn-edit {background: #ffa500;color: black;}
        .btn-delete {background: #ff073a;color: white;}
        .btn-toggle {background: #0088cc;color: white;}
        .stats {display: flex;gap: 20px;margin: 20px 0;}
        .stat-card {background: rgba(255,7,58,0.2);padding: 15px;border-radius: 8px;border: 1px solid #ff073a;text-align: center;flex: 1;}
        .stat-number {font-size: 24px;color: #ff073a;font-weight: bold;}
    </style>
</head>
<body>
<div class="nav-links">
    <a href="/san-pham">GEAR</a> |
    <a href="/nha-san-xuat">Nhà sản xuất</a> |
    <a href="/thong-ke">Thống kê</a> |
    <a href="/mua-hang">Mua hàng</a> |
    <a href="/quan-ly-tai-khoan">Quản lý tài khoản</a> |
    <a href="/login">Đăng xuất</a>
</div>

<h1>QUẢN LÝ TÀI KHOẢN NGƯỜI DÙNG</h1>

<!-- Thống kê - Sử dụng dữ liệu đã tính toán từ controller -->
<div class="stats">
    <div class="stat-card">
        <div class="stat-number" th:text="${totalUsers}">0</div>
        <div>Tổng số tài khoản</div>
    </div>
    <div class="stat-card">
        <div class="stat-number" th:text="${activeUsers}">0</div>
        <div>Tài khoản đang hoạt động</div>
    </div>
    <div class="stat-card">
        <div class="stat-number" th:text="${inactiveUsers}">0</div>
        <div>Tài khoản bị khóa</div>
    </div>
</div>

<h2>Danh sách tài khoản người dùng</h2>

<table>
    <tr>
        <th>ID</th>
        <th>Tên đăng nhập</th>
        <th>Họ và tên</th>
        <th>Email</th>
        <th>Số điện thoại</th>
        <th>Ngày tạo</th>
        <th>Trạng thái</th>
        <th>Hành động</th>
    </tr>
    <tr th:each="user : ${users}">
        <td th:text="${user.id}"></td>
        <td th:text="${user.username}"></td>
        <td th:text="${user.fullName}"></td>
        <td th:text="${user.email}"></td>
        <td th:text="${user.phone}"></td>
        <td th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy HH:mm')}"></td>
        <td>
            <span th:if="${user.active}" class="status-active">Đang hoạt động</span>
            <span th:unless="${user.active}" class="status-inactive">Đã khóa</span>
        </td>
        <td>
            <div class="action-buttons">
                <a th:href="@{'/quan-ly-tai-khoan/edit/' + ${user.id}}" class="btn btn-edit">Sửa</a>
                <a th:href="@{'/quan-ly-tai-khoan/toggle/' + ${user.id}}"
                   class="btn btn-toggle"
                   th:text="${user.active} ? 'Khóa' : 'Kích hoạt'"
                   onclick="return confirm('Bạn có chắc muốn thay đổi trạng thái tài khoản này?')"></a>
            </div>
        </td>
    </tr>
</table>

<!-- Form chỉnh sửa tài khoản -->
<div th:if="${user != null}">
    <h2>Chỉnh sửa thông tin tài khoản</h2>
    <form action="/quan-ly-tai-khoan/save" method="post" style="margin-bottom: 20px;padding: 15px;border: 2px solid #ff073a;border-radius: 8px;background: rgba(30,30,30,0.85);">
        <input type="hidden" name="id" th:value="${user.id}">

        <div style="margin: 10px 0;">
            <label>Tên đăng nhập:</label>
            <input type="text" th:value="${user.username}" disabled style="background: #333;">
        </div>

        <div style="margin: 10px 0;">
            <label>Họ và tên:</label>
            <input type="text" name="fullName" th:value="${user.fullName}" required>
        </div>

        <div style="margin: 10px 0;">
            <label>Email:</label>
            <input type="email" name="email" th:value="${user.email}" required>
        </div>

        <div style="margin: 10px 0;">
            <label>Số điện thoại:</label>
            <input type="tel" name="phone" th:value="${user.phone}" required>
        </div>

        <div style="margin: 10px 0;">
            <label>Trạng thái:</label>
            <select name="active">
                <option value="true" th:selected="${user.active}">Đang hoạt động</option>
                <option value="false" th:selected="${!user.active}">Đã khóa</option>
            </select>
        </div>

        <button type="submit" style="background: #ff073a;color: white;padding: 10px 20px;border: none;border-radius: 5px;cursor: pointer;">Cập nhật</button>
        <a href="/quan-ly-tai-khoan" style="margin-left: 10px;color: #ff073a;">Hủy</a>
    </form>
</div>

<div th:if="${#lists.isEmpty(users)}" style="text-align: center; margin-top: 50px;">
    <h3>Chưa có tài khoản người dùng nào</h3>
</div>

</body>
</html>